(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const a of r)if(a.type==="childList")for(const o of a.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function t(r){const a={};return r.integrity&&(a.integrity=r.integrity),r.referrerPolicy&&(a.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?a.credentials="include":r.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(r){if(r.ep)return;r.ep=!0;const a=t(r);fetch(r.href,a)}})();class y{constructor(e){this.gameBoard=e||this.createEmptyBoard(),this.gameScore=0,this.gameStatus="idle"}arraysEqual(e,t){return e.length===t.length&&e.every((s,r)=>s===t[r])}updateGameStatus(){this.gameBoard.some(e=>e.includes(2048))?this.gameStatus="win":this.isGameOver()&&(this.gameStatus="lose")}mergeRow(e){const t=[];let s=!1;for(let r=0;r<e.length;r++){if(s){s=!1;continue}if(r+1<e.length&&e[r]===e[r+1]){const a=e[r]*2;this.gameScore+=a,t.push(a),s=!0}else t.push(e[r])}for(;t.length<4;)t.push(0);return t}moveLeft(){let e=!1;for(let t=0;t<4;t++){const s=[...this.gameBoard[t]],r=s.filter(o=>o!==0),a=this.mergeRow(r);this.arraysEqual(s,a)||(e=!0,this.gameBoard[t]=a)}e&&this.addRandomTile(),this.updateGameStatus()}moveRight(){let e=!1;for(let t=0;t<4;t++){const s=[...this.gameBoard[t]],r=s.slice().reverse().filter(d=>d!==0),o=this.mergeRow(r).reverse();this.arraysEqual(s,o)||(e=!0,this.gameBoard[t]=o)}e&&this.addRandomTile(),this.updateGameStatus()}moveUp(){let e=!1;for(let t=0;t<4;t++){const s=this.gameBoard.map(o=>o[t]),r=s.filter(o=>o!==0),a=this.mergeRow(r);if(!this.arraysEqual(s,a)){e=!0;for(let o=0;o<4;o++)this.gameBoard[o][t]=a[o]}}e&&this.addRandomTile(),this.updateGameStatus()}moveDown(){let e=!1;for(let t=0;t<4;t++){const s=this.gameBoard.map(d=>d[t]),r=s.slice().reverse().filter(d=>d!==0),o=this.mergeRow(r).reverse();if(!this.arraysEqual(s,o)){e=!0;for(let d=0;d<4;d++)this.gameBoard[d][t]=o[d]}}e&&this.addRandomTile(),this.updateGameStatus()}createEmptyBoard(){return Array.from({length:4},()=>Array(4).fill(0))}addRandomTile(){const e=[];for(let r=0;r<4;r++)for(let a=0;a<4;a++)this.gameBoard[r][a]===0&&e.push({rr:r,cc:a});if(!e.length)return;const{rr:t,cc:s}=e[Math.floor(Math.random()*e.length)];this.gameBoard[t][s]=Math.random()<.9?2:4}getScore(){return this.gameScore}getState(){return this.gameBoard}getStatus(){return this.gameStatus}start(){this.gameBoard=this.createEmptyBoard(),this.gameStatus="playing",this.gameScore=0,this.addRandomTile(),this.addRandomTile()}restart(){this.gameBoard=this.createEmptyBoard(),this.gameStatus="idle",this.gameScore=0}isGameOver(){for(let e=0;e<4;e++)for(let t=0;t<4;t++)if(this.gameBoard[e][t]===0||e<3&&this.gameBoard[e][t]===this.gameBoard[e+1][t]||t<3&&this.gameBoard[e][t]===this.gameBoard[e][t+1])return!1;return!0}}const n=new y,v=document.querySelectorAll(".field-cell"),B=document.querySelector(".game-score"),u=document.querySelector(".message-start"),p=document.querySelector(".message-lose"),S=document.querySelector(".message-win"),c=document.querySelector(".start"),m=document.querySelector(".restart");function h(i){i.flat().forEach((e,t)=>{const s=v[t];s.textContent=e===0?"":e,s.className="field-cell",e&&s.classList.add(`field-cell--${e}`)})}function f(i){B.textContent=i}function g(i){u.classList.add("hidden"),p.classList.add("hidden"),S.classList.add("hidden"),i==="win"?S.classList.remove("hidden"):i==="lose"?p.classList.remove("hidden"):i==="idle"&&u.classList.remove("hidden")}function l(i){return new Promise(e=>{const t=JSON.stringify(n.getState());i==="left"&&n.moveLeft(),i==="right"&&n.moveRight(),i==="up"&&n.moveUp(),i==="down"&&n.moveDown();const s=JSON.stringify(n.getState());t!==s?setTimeout(()=>e(),150):e()}).then(()=>{h(n.getState()),f(n.getScore()),g(n.getStatus())})}c.addEventListener("click",()=>{n.start(),h(n.getState()),f(n.getScore()),g("playing"),c.classList.add("hidden"),m.classList.remove("hidden")});m.addEventListener("click",()=>{n.restart(),h(n.getState()),f(n.getScore()),g("idle"),m.classList.add("hidden"),c.classList.remove("hidden")});document.addEventListener("keydown",i=>{if(n.getStatus()==="playing")switch(i.key){case"ArrowLeft":l("left");break;case"ArrowRight":l("right");break;case"ArrowUp":l("up");break;case"ArrowDown":l("down");break}});
